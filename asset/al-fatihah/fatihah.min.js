/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘  ILM AL-FATIHAH PREMIUM READER v3.0                                       â•‘
 * â•‘  The Most Advanced Surah Al-Fatihah Interactive Tool                      â•‘
 * â•‘                                                                           â•‘
 * â•‘  Â© 2025 IlmuAlam.com - All Rights Reserved                                â•‘
 * â•‘  License: Proprietary - For use on ilmualam.com only                      â•‘
 * â•‘  GitHub CDN Hosting Permitted                                             â•‘
 * â•‘                                                                           â•‘
 * â•‘  UNIQUE FEATURES (Competitor Differentiation):                            â•‘
 * â•‘  âœ“ Word-by-word Arabic breakdown with hover translation                   â•‘
 * â•‘  âœ“ Tajwid color-coded highlighting                                        â•‘
 * â•‘  âœ“ Multiple qari audio selection (8 qaris)                                â•‘
 * â•‘  âœ“ Auto-scroll during playback                                            â•‘
 * â•‘  âœ“ Repeat mode for memorization (hafazan)                                 â•‘
 * â•‘  âœ“ Playback speed control (0.5x - 1.5x)                                   â•‘
 * â•‘  âœ“ Progress tracking with localStorage                                    â•‘
 * â•‘  âœ“ Print-friendly mode                                                    â•‘
 * â•‘  âœ“ Share individual ayat                                                  â•‘
 * â•‘  âœ“ Dark/Light theme                                                       â•‘
 * â•‘  âœ“ Keyboard shortcuts                                                     â•‘
 * â•‘  âœ“ Mobile-optimized touch gestures                                        â•‘
 * â•‘                                                                           â•‘
 * â•‘  API: Al-Quran Cloud (alquran.cloud)                                      â•‘
 * â•‘  Audio CDN: Islamic Network                                               â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

(function() {
    'use strict';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIGURATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const CONFIG = {
        surahNumber: 1,
        surahName: 'Al-Fatihah',
        surahNameArabic: 'Ø§Ù„ÙØ§ØªØ­Ø©',
        surahMeaning: 'Pembukaan',
        totalAyat: 7,
        containerId: 'ilm-alfatihah-reader',
        apiBase: 'https://api.alquran.cloud/v1',
        defaultQari: 'ar.alafasy',
        storageKey: 'ilm_alfatihah_v3',
        domain: 'ilmualam.com',
        qariList: [
            { id: 'ar.alafasy', name: 'Mishary Rashid Alafasy', flag: 'ğŸ‡°ğŸ‡¼' },
            { id: 'ar.abdulbasitmurattal', name: 'Abdul Basit (Murattal)', flag: 'ğŸ‡ªğŸ‡¬' },
            { id: 'ar.abdullahbasfar', name: 'Abdullah Basfar', flag: 'ğŸ‡¸ğŸ‡¦' },
            { id: 'ar.hudhaify', name: 'Ali Al-Hudhaify', flag: 'ğŸ‡¸ğŸ‡¦' },
            { id: 'ar.minshawi', name: 'Mohamed Siddiq El-Minshawi', flag: 'ğŸ‡ªğŸ‡¬' },
            { id: 'ar.muhammadayyoub', name: 'Muhammad Ayyub', flag: 'ğŸ‡¸ğŸ‡¦' },
            { id: 'ar.muhammadjibreel', name: 'Muhammad Jibreel', flag: 'ğŸ‡ªğŸ‡¬' },
            { id: 'ar.saaboramah', name: 'Saad Al-Ghamdi', flag: 'ğŸ‡¸ğŸ‡¦' }
        ]
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AL-FATIHAH COMPLETE DATA (Pre-loaded for instant display)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const FATIHAH_DATA = [
        {
            number: 1,
            arabic: 'Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù',
            rumi: "BismillÄhir-raá¸¥mÄnir-raá¸¥Ä«m",
            translation: "Dengan nama Allah, Yang Maha Pengasih, lagi Maha Penyayang.",
            wordByWord: [
                { ar: 'Ø¨ÙØ³Ù’Ù…Ù', rumi: 'bismi', ms: 'Dengan nama' },
                { ar: 'Ø§Ù„Ù„ÙÙ‘Ù‡Ù', rumi: 'AllÄhi', ms: 'Allah' },
                { ar: 'Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù', rumi: 'ar-Raá¸¥mÄni', ms: 'Yang Maha Pengasih' },
                { ar: 'Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù', rumi: 'ar-Raá¸¥Ä«m', ms: 'lagi Maha Penyayang' }
            ],
            tajwid: 'Idgham bila ghunnah pada "Bismillah"',
            tafsir: 'Ayat ini mengajar kita memulakan setiap perkara dengan nama Allah. Ar-Rahman merujuk kasih sayang Allah yang meliputi semua makhluk, manakala Ar-Rahim khusus untuk orang beriman.'
        },
        {
            number: 2,
            arabic: 'Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù',
            rumi: "Al-á¸¥amdu lillÄhi rabbil-'ÄlamÄ«n",
            translation: "Segala puji bagi Allah, Tuhan sekalian alam.",
            wordByWord: [
                { ar: 'Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù', rumi: 'al-á¸¥amdu', ms: 'Segala puji' },
                { ar: 'Ù„ÙÙ„ÙÙ‘Ù‡Ù', rumi: 'lillÄhi', ms: 'bagi Allah' },
                { ar: 'Ø±ÙØ¨ÙÙ‘', rumi: 'Rabbi', ms: 'Tuhan' },
                { ar: 'Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù', rumi: "al-'ÄlamÄ«n", ms: 'sekalian alam' }
            ],
            tajwid: 'Ghunnah pada huruf mim bertasydid',
            tafsir: 'Pujian mutlak hanya layak untuk Allah sebagai Pencipta, Pemelihara dan Pentadbir seluruh alam semesta termasuk manusia, jin, malaikat, haiwan dan tumbuhan.'
        },
        {
            number: 3,
            arabic: 'Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù',
            rumi: "Ar-raá¸¥mÄnir-raá¸¥Ä«m",
            translation: "Yang Maha Pengasih, lagi Maha Penyayang.",
            wordByWord: [
                { ar: 'Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù', rumi: 'ar-Raá¸¥mÄni', ms: 'Yang Maha Pengasih' },
                { ar: 'Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù', rumi: 'ar-Raá¸¥Ä«m', ms: 'lagi Maha Penyayang' }
            ],
            tajwid: 'Mad asli (2 harakat) pada huruf alif',
            tafsir: 'Pengulangan dua sifat ini menekankan betapa luasnya rahmat Allah. Ar-Rahman bersifat umum untuk semua makhluk, Ar-Rahim bersifat khusus untuk orang beriman di akhirat.'
        },
        {
            number: 4,
            arabic: 'Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù',
            rumi: "MÄliki yawmid-dÄ«n",
            translation: "Yang Menguasai hari pembalasan.",
            wordByWord: [
                { ar: 'Ù…ÙØ§Ù„ÙÙƒÙ', rumi: 'MÄliki', ms: 'Yang Menguasai' },
                { ar: 'ÙŠÙÙˆÙ’Ù…Ù', rumi: 'yawmi', ms: 'hari' },
                { ar: 'Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù', rumi: 'ad-dÄ«n', ms: 'pembalasan' }
            ],
            tajwid: 'Qalqalah sughra pada huruf dal',
            tafsir: 'Allah adalah Pemilik dan Penguasa mutlak pada Hari Kiamat. Tiada siapa yang boleh memberi syafaat atau menolong melainkan dengan izin-Nya.'
        },
        {
            number: 5,
            arabic: 'Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù',
            rumi: "IyyÄka na'budu wa iyyÄka nasta'Ä«n",
            translation: "Hanya Engkau yang kami sembah, dan hanya kepada Engkau kami mohon pertolongan.",
            wordByWord: [
                { ar: 'Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ', rumi: 'IyyÄka', ms: 'Hanya Engkau' },
                { ar: 'Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù', rumi: "na'budu", ms: 'kami sembah' },
                { ar: 'ÙˆÙ', rumi: 'wa', ms: 'dan' },
                { ar: 'Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ', rumi: 'iyyÄka', ms: 'hanya kepada Engkau' },
                { ar: 'Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù', rumi: "nasta'Ä«n", ms: 'kami mohon pertolongan' }
            ],
            tajwid: 'Mad jaiz munfasil pada "iyyÄka"',
            tafsir: 'Ayat ini adalah intipati tauhid - menyembah Allah sahaja dan memohon pertolongan hanya kepada-Nya. Ini adalah perjanjian antara hamba dengan Tuhannya.'
        },
        {
            number: 6,
            arabic: 'Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù',
            rumi: "Ihdinaá¹£-á¹£irÄá¹­al-mustaqÄ«m",
            translation: "Tunjukilah kami jalan yang lurus.",
            wordByWord: [
                { ar: 'Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§', rumi: 'IhdinÄ', ms: 'Tunjukilah kami' },
                { ar: 'Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù', rumi: 'aá¹£-á¹£irÄá¹­a', ms: 'jalan' },
                { ar: 'Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù', rumi: 'al-mustaqÄ«m', ms: 'yang lurus' }
            ],
            tajwid: 'Ikhfa hakiki pada nun sakinah sebelum Øµ',
            tafsir: 'Doa memohon petunjuk ke jalan Islam yang lurus - jalan para nabi, siddiqin, syuhada dan solihin. Kita memohon hidayah ini sekurang-kurangnya 17 kali sehari dalam solat.'
        },
        {
            number: 7,
            arabic: 'ØµÙØ±ÙØ§Ø·Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù',
            rumi: "á¹¢irÄá¹­al-lazÄ«na an'amta 'alaihim ghairil-maghá¸Å«bi 'alaihim wa laá¸-á¸ÄllÄ«n",
            translation: "Iaitu jalan orang-orang yang Engkau kurniakan nikmat kepada mereka, bukan (jalan) orang yang dimurkai, dan bukan (jalan) orang yang sesat.",
            wordByWord: [
                { ar: 'ØµÙØ±ÙØ§Ø·Ù', rumi: 'á¹¢irÄá¹­a', ms: 'Jalan' },
                { ar: 'Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù', rumi: 'allazÄ«na', ms: 'orang-orang yang' },
                { ar: 'Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ', rumi: "an'amta", ms: 'Engkau kurniakan nikmat' },
                { ar: 'Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’', rumi: "'alaihim", ms: 'kepada mereka' },
                { ar: 'ØºÙÙŠÙ’Ø±Ù', rumi: 'ghairi', ms: 'bukan' },
                { ar: 'Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù', rumi: 'al-maghá¸Å«bi', ms: 'yang dimurkai' },
                { ar: 'Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’', rumi: "'alaihim", ms: 'ke atas mereka' },
                { ar: 'ÙˆÙÙ„ÙØ§', rumi: 'wa lÄ', ms: 'dan bukan' },
                { ar: 'Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù', rumi: 'aá¸-á¸ÄllÄ«n', ms: 'yang sesat' }
            ],
            tajwid: 'Mad lazim kalimi mutsaqqal pada "Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù" (6 harakat)',
            tafsir: 'Penjelasan jalan yang lurus iaitu jalan para nabi dan orang soleh. "Maghdhubi alaihim" merujuk kepada mereka yang tahu kebenaran tetapi enggan mengikutinya. "Dhallin" merujuk kepada mereka yang sesat kerana kejahilan.'
        }
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let state = {
        currentAyat: 1,
        isPlaying: false,
        currentQari: CONFIG.defaultQari,
        darkMode: false,
        showRumi: true,
        showTranslation: true,
        showWordByWord: false,
        showTajwid: false,
        showTafsir: false,
        repeatMode: false,
        repeatCount: 1,
        currentRepeat: 0,
        playbackSpeed: 1,
        audio: null,
        isLoading: false,
        readCount: 0
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITY FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function loadState() {
        try {
            const saved = localStorage.getItem(CONFIG.storageKey);
            if (saved) {
                const data = JSON.parse(saved);
                state = { ...state, ...data };
            }
        } catch (e) { console.warn('ILM: Load state failed'); }
    }

    function saveState() {
        try {
            localStorage.setItem(CONFIG.storageKey, JSON.stringify({
                currentQari: state.currentQari,
                darkMode: state.darkMode,
                showRumi: state.showRumi,
                showTranslation: state.showTranslation,
                showWordByWord: state.showWordByWord,
                showTajwid: state.showTajwid,
                showTafsir: state.showTafsir,
                playbackSpeed: state.playbackSpeed,
                readCount: state.readCount
            }));
        } catch (e) { console.warn('ILM: Save state failed'); }
    }

    function showToast(msg, duration = 2500) {
        const toast = document.getElementById('ilm-fh-toast');
        if (toast) {
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), duration);
        }
    }

    function getAudioUrl(ayatNum) {
        return `https://cdn.islamic.network/quran/audio/128/${state.currentQari}/${ayatNum}.mp3`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GENERATE STYLES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function generateStyles() {
        return `
<style>
.ilm-fh-wrap{font-family:'Inter',system-ui,-apple-system,sans-serif;max-width:100%;margin:0 auto;border-radius:20px;overflow:hidden;background:#fff;box-shadow:0 8px 32px rgba(36,151,73,0.12)}
.ilm-fh-wrap.dark{background:#0f1419;color:#e7e9ea}
.ilm-fh-header{background:linear-gradient(135deg,#249749 0%,#1b7a3a 50%,#0c5c27 100%);color:#fff!important;padding:12px 14px;text-align:center;position:relative;overflow:hidden}
.ilm-fh-header::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 60%);animation:ilm-shimmer 15s linear infinite}
@keyframes ilm-shimmer{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.ilm-fh-header .arabic-title{font-family:'Amiri','Traditional Arabic',serif;font-size:3rem;margin-bottom:8px;text-shadow:0 2px 4px rgba(0,0,0,0.2)}
.ilm-fh-header h2{margin:0;font-size:1.4rem;font-weight:600;color:#fff;}
.ilm-fh-header .subtitle{font-size:0.95rem;opacity:0.9;margin-top:4px}
.ilm-fh-header .meta-badges{display:flex;justify-content:center;gap:10px;margin-top:12px;flex-wrap:wrap}
.ilm-fh-header .badge{background:rgba(255,255,255,0.2);padding:4px 12px;border-radius:20px;font-size:0.8rem}
.ilm-fh-stats{display:grid;grid-template-columns:repeat(4,1fr);background:#f8fdf9;border-bottom:1px solid #e8f5e9}
.ilm-fh-wrap.dark .ilm-fh-stats{background:#1a2634;border-color:#2d3741}
.ilm-fh-stats div{padding:16px;text-align:center;border-right:1px solid #e8f5e9}
.ilm-fh-wrap.dark .ilm-fh-stats div{border-color:#2d3741}
.ilm-fh-stats div:last-child{border:none}
.ilm-fh-stats strong{display:block;font-size:1.2rem;color:#249749}
.ilm-fh-stats span{font-size:0.75rem;color:#666}
.ilm-fh-wrap.dark .ilm-fh-stats span{color:#8899a6}
.ilm-fh-controls{display:flex;flex-wrap:wrap;gap:8px;padding:16px;background:#fafafa;border-bottom:1px solid #eee;align-items:center;justify-content:center}
.ilm-fh-wrap.dark .ilm-fh-controls{background:#1a2634;border-color:#2d3741}
.ilm-fh-btn{display:inline-flex !important;visibility:visible !important;opacity:1 !important;align-items:center;gap:4px;padding:8px 14px;border:none;border-radius:10px;cursor:pointer;font-size:0.75rem;font-weight:500;transition:all 0.2s ease;background:#fff;color:#333;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
.ilm-fh-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.ilm-fh-btn:active{transform:translateY(0)}
.ilm-fh-btn.primary{background:linear-gradient(135deg,#249749,#1b7a3a);color:#fff}
.ilm-fh-btn.active{background:#1b5e20;color:#fff}
.ilm-fh-btn.danger{background:#ffebee;color:#c62828}
.ilm-fh-wrap.dark .ilm-fh-btn{background:#2d3741;color:#e7e9ea}
.ilm-fh-wrap.dark .ilm-fh-btn.primary{background:linear-gradient(135deg,#249749,#1b7a3a)}
.ilm-fh-select{padding:10px 14px;border:1px solid #ddd;border-radius:10px;font-size:0.9rem;background:#fff;cursor:pointer;min-width:140px}
.ilm-fh-wrap.dark .ilm-fh-select{background:#2d3741;color:#e7e9ea;border-color:#3d4f5f}
.ilm-fh-options{display:flex;flex-wrap:wrap;gap:4px;padding:10px 14px;background:#f5f5f5;border-bottom:1px solid #eee}
.ilm-fh-wrap.dark .ilm-fh-options{background:#1a2634;border-color:#2d3741}
.ilm-fh-chip{padding:6px 14px;border-radius:10px;font-size:0.75rem;cursor:pointer;background:#fff;color:#666;border:1px solid #ddd;transition:all 0.2s}
.ilm-fh-chip:hover,.ilm-fh-chip.active{background:#249749;color:#fff;border-color:#249749}
.ilm-fh-wrap.dark .ilm-fh-chip{background:#2d3741;color:#8899a6;border-color:#3d4f5f}
.ilm-fh-progress{height:6px;background:#e0e0e0;margin:0 16px 8px;border-radius:3px;overflow:hidden}
.ilm-fh-wrap.dark .ilm-fh-progress{background:#2d3741}
.ilm-fh-progress-bar{height:100%;background:linear-gradient(90deg,#249749,#4caf50);width:0%;transition:width 0.3s;border-radius:3px}
.ilm-fh-content{padding:8px 0}
.ilm-fh-ayat{padding:24px 20px;margin:8px 16px;border-radius:16px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.04);transition:all 0.3s ease;border:2px solid transparent}
.ilm-fh-wrap.dark .ilm-fh-ayat{background:#1a2634}
.ilm-fh-ayat:hover{box-shadow:0 4px 16px rgba(36,151,73,0.1)}
.ilm-fh-ayat.playing{border-color:#249749;background:linear-gradient(135deg,#f1f8e9,#e8f5e9)}
.ilm-fh-wrap.dark .ilm-fh-ayat.playing{background:linear-gradient(135deg,#1a2634,#1e3a2f)}
.ilm-fh-ayat-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.ilm-fh-ayat-num{display:flex;align-items:center;justify-content:center;width:44px;height:44px;background:linear-gradient(135deg,#249749,#1b7a3a);color:#fff;border-radius:12px;font-size:1.1rem;font-weight:700;box-shadow:0 4px 12px rgba(36,151,73,0.3)}
.ilm-fh-ayat-actions{display:flex;gap:6px}
.ilm-fh-ayat-btn{width:36px;height:36px;border-radius:8px;border:none;background:#f5f5f5;color:#666;cursor:pointer;display:flex !important;visibility:visible !important;opacity:1 !important;align-items:center;justify-content:center;transition:all 0.2s}
.ilm-fh-ayat-btn:hover{background:#249749;color:#fff}
.ilm-fh-wrap.dark .ilm-fh-ayat-btn{background:#2d3741;color:#8899a6}
.ilm-fh-arabic{font-family:'Traditional Arabic','Scheherazade New','Amiri',serif;font-size:2.2rem;line-height:2.4;direction:rtl;text-align:right;color:#1a1a1a;margin-bottom:16px;padding:16px 0;border-bottom:1px solid #f0f0f0}
.ilm-fh-wrap.dark .ilm-fh-arabic{color:#fff;border-color:#2d3741}
.ilm-fh-word-breakdown{display:flex;flex-wrap:wrap;justify-content:flex-end;gap:12px;direction:rtl;margin:16px 0;padding:16px;background:#f8fdf9;border-radius:12px}
.ilm-fh-wrap.dark .ilm-fh-word-breakdown{background:#0f1419}
.ilm-fh-word{text-align:center;padding:8px 12px;background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.05);cursor:pointer;transition:all 0.2s;min-width:60px}
.ilm-fh-word:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(36,151,73,0.2)}
.ilm-fh-wrap.dark .ilm-fh-word{background:#1a2634}
.ilm-fh-word .ar{font-family:'Traditional Arabic',serif;font-size:1.4rem;color:#249749;display:block}
.ilm-fh-word .rm{font-size:0.75rem;color:#666;font-style:italic}
.ilm-fh-word .ms{font-size:0.7rem;color:#1b5e20;margin-top:4px;font-weight:500}
.ilm-fh-wrap.dark .ilm-fh-word .rm{color:#8899a6}
.ilm-fh-wrap.dark .ilm-fh-word .ms{color:#4caf50}
.ilm-fh-rumi{font-style:italic;color:#5d4037;font-size:1.1rem;margin-bottom:12px;line-height:1.7;padding:12px 16px;background:#fffde7;border-radius:8px;border-left:4px solid #ffc107}
.ilm-fh-wrap.dark .ilm-fh-rumi{background:#2d2a1f;color:#ffd54f;border-color:#ffc107}
.ilm-fh-translation{color:#2e7d32;font-size:1.05rem;line-height:1.7;padding:12px 16px;background:#e8f5e9;border-radius:8px}
.ilm-fh-wrap.dark .ilm-fh-translation{background:#1e3a2f;color:#81c784}
.ilm-fh-tajwid{margin-top:12px;padding:12px 16px;background:#e3f2fd;border-radius:8px;font-size:0.9rem;color:#1565c0}
.ilm-fh-wrap.dark .ilm-fh-tajwid{background:#1a2634;color:#64b5f6}
.ilm-fh-tajwid strong{color:#0d47a1}
.ilm-fh-wrap.dark .ilm-fh-tajwid strong{color:#90caf9}
.ilm-fh-tafsir{margin-top:12px;padding:16px;background:#fce4ec;border-radius:8px;font-size:0.95rem;color:#880e4f;line-height:1.7}
.ilm-fh-wrap.dark .ilm-fh-tafsir{background:#2d1f26;color:#f48fb1}
.ilm-fh-nav{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#fafafa;border-top:1px solid #eee}
.ilm-fh-wrap.dark .ilm-fh-nav{background:#1a2634;border-color:#2d3741}
.ilm-fh-position{font-weight:600;color:#249749}
.ilm-fh-speed{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#f5f5f5;margin:12px 12px;border-radius:10px}
.ilm-fh-wrap.dark .ilm-fh-speed{background:#1a2634}
.ilm-fh-speed input{flex:1;accent-color:#249749}
.ilm-fh-footer{text-align:center;padding:16px;font-size:0.8rem;color:#999;background:#f5f5f5;border-top:1px solid #eee}
.ilm-fh-wrap.dark .ilm-fh-footer{background:#0f1419;border-color:#2d3741;color:#5b7083}
.ilm-fh-toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:#333;color:#fff;padding:14px 28px;border-radius:12px;font-size:0.95rem;z-index:10000;transition:transform 0.3s ease;box-shadow:0 8px 24px rgba(0,0,0,0.3)}
.ilm-fh-toast.show{transform:translateX(-50%) translateY(0)}
.ilm-fh-repeat-badge{position:absolute;top:-6px;right:-6px;background:#ff5722;color:#fff;font-size:0.7rem;padding:2px 6px;border-radius:10px}
@media(max-width:600px){
.ilm-fh-header .arabic-title{font-size:2.2rem}
.ilm-fh-header h2{font-size:1.5rem;color:#fff;text-align:center;}
.ilm-fh-stats{grid-template-columns:repeat(2,1fr)}
.ilm-fh-arabic{font-size:1.7rem}
.ilm-fh-ayat{padding:16px;margin:8px 12px}
.ilm-fh-controls{padding:12px}
.ilm-fh-btn{padding:8px 12px;font-size:0.85rem}
.ilm-fh-word-breakdown{gap:8px}
.ilm-fh-word{min-width:50px;padding:6px 8px}
.ilm-fh-word .ar{font-size:1.2rem}
}
</style>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GENERATE HTML
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function generateHTML() {
        const qariOptions = CONFIG.qariList.map(q =>
            `<option value="${q.id}" ${q.id === state.currentQari ? 'selected' : ''}>${q.flag} ${q.name}</option>`
        ).join('');

        return `
${generateStyles()}
<div class="ilm-fh-wrap ${state.darkMode ? 'dark' : ''}" id="ilm-fh-main">
    <div class="ilm-fh-header">
        <div class="arabic-title">${CONFIG.surahNameArabic}</div>
        <h2>Surah ${CONFIG.surahName}</h2>
        <div class="subtitle">Ummul Kitab â€¢ As-Sab'ul Mathani â€¢ ${CONFIG.surahMeaning}</div>
        <div class="meta-badges">
            <span class="badge">ğŸ“– Surah ke-1</span>
            <span class="badge">âœ¨ 7 Ayat</span>
            <span class="badge">ğŸ•Œ Makkiyyah</span>
            <span class="badge">ğŸ“¿ Dibaca ${state.readCount}x</span>
        </div>
    </div>

    <div class="ilm-fh-stats">
        <div><strong>1</strong><span>Surah</span></div>
        <div><strong>7</strong><span>Ayat</span></div>
        <div><strong>29</strong><span>Perkataan</span></div>
        <div><strong>139</strong><span>Huruf</span></div>
    </div>

    <div class="ilm-fh-controls">
        <button class="ilm-fh-btn primary" id="ilm-fh-play">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
            Play All
        </button>
        <button class="ilm-fh-btn" id="ilm-fh-stop">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="10" height="10"/></svg>
        </button>
        <button class="ilm-fh-btn ${state.repeatMode ? 'active' : ''}" id="ilm-fh-repeat" style="position:relative">
            ğŸ” Ulang
            ${state.repeatMode ? `<span class="ilm-fh-repeat-badge">${state.repeatCount}x</span>` : ''}
        </button>
        <select class="ilm-fh-select" id="ilm-fh-qari">${qariOptions}</select>
        <button class="ilm-fh-btn" id="ilm-fh-dark">${state.darkMode ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark'}</button>
    </div>

    <div class="ilm-fh-options">
        <span class="ilm-fh-chip ${state.showRumi ? 'active' : ''}" id="ilm-fh-rumi-toggle">ğŸ“ Rumi</span>
        <span class="ilm-fh-chip ${state.showTranslation ? 'active' : ''}" id="ilm-fh-trans-toggle">ğŸ‡²ğŸ‡¾ Terjemahan</span>
        <span class="ilm-fh-chip ${state.showWordByWord ? 'active' : ''}" id="ilm-fh-wbw-toggle">ğŸ“š Perkataan</span>
        <span class="ilm-fh-chip ${state.showTajwid ? 'active' : ''}" id="ilm-fh-tajwid-toggle">ğŸ¯ Tajwid</span>
        <span class="ilm-fh-chip ${state.showTafsir ? 'active' : ''}" id="ilm-fh-tafsir-toggle">ğŸ“– Tafsir</span>
    </div>

    <div class="ilm-fh-speed">
        <span>ğŸ¢</span>
        <input type="range" id="ilm-fh-speed-slider" min="0.5" max="1.5" step="0.1" value="${state.playbackSpeed}">
        <span>ğŸ‡</span>
        <span id="ilm-fh-speed-label">${state.playbackSpeed}x</span>
    </div>

    <div class="ilm-fh-progress">
        <div class="ilm-fh-progress-bar" id="ilm-fh-progress-bar"></div>
    </div>

    <div class="ilm-fh-content" id="ilm-fh-content"></div>

    <div class="ilm-fh-nav">
        <button class="ilm-fh-btn" id="ilm-fh-prev">â† Sebelum</button>
        <span class="ilm-fh-position" id="ilm-fh-position">1 / 7</span>
        <button class="ilm-fh-btn" id="ilm-fh-next">Seterus â†’</button>
    </div>

    <div class="ilm-fh-footer">
        Tool Bacaan Surah Al-Fatihah Â© <a href="https://ilmualam.com" target="_blank" style="color:#249749">IlmuAlam.com</a> 2025 | Versi 3.0
    </div>
</div>
<div class="ilm-fh-toast" id="ilm-fh-toast"></div>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER VERSES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderVerses() {
        const content = document.getElementById('ilm-fh-content');
        if (!content) return;

        content.innerHTML = FATIHAH_DATA.map(verse => `
            <div class="ilm-fh-ayat ${state.currentAyat === verse.number ? 'playing' : ''}" 
                 data-ayat="${verse.number}" id="ilm-fh-ayat-${verse.number}">
                
                <div class="ilm-fh-ayat-header">
                    <div class="ilm-fh-ayat-num">${verse.number}</div>
                    <div class="ilm-fh-ayat-actions">
                        <button class="ilm-fh-ayat-btn play-single" data-ayat="${verse.number}" title="Play ayat ini">â–¶</button>
                        <button class="ilm-fh-ayat-btn copy-ayat" data-ayat="${verse.number}" title="Copy">ğŸ“‹</button>
                        <button class="ilm-fh-ayat-btn share-ayat" data-ayat="${verse.number}" title="Share">ğŸ“¤</button>
                    </div>
                </div>

                <div class="ilm-fh-arabic">${verse.arabic}</div>

                ${state.showWordByWord ? `
                <div class="ilm-fh-word-breakdown">
                    ${verse.wordByWord.map(w => `
                        <div class="ilm-fh-word">
                            <span class="ar">${w.ar}</span>
                            <span class="rm">${w.rumi}</span>
                            <span class="ms">${w.ms}</span>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                ${state.showRumi ? `<div class="ilm-fh-rumi">${verse.rumi}</div>` : ''}
                
                ${state.showTranslation ? `<div class="ilm-fh-translation">${verse.translation}</div>` : ''}
                
                ${state.showTajwid ? `<div class="ilm-fh-tajwid"><strong>ğŸ¯ Tajwid:</strong> ${verse.tajwid}</div>` : ''}
                
                ${state.showTafsir ? `<div class="ilm-fh-tafsir"><strong>ğŸ“– Tafsir:</strong> ${verse.tafsir}</div>` : ''}
            </div>
        `).join('');

        // Bind events
        content.querySelectorAll('.play-single').forEach(btn => {
            btn.addEventListener('click', e => {
                const ayat = parseInt(e.currentTarget.dataset.ayat);
                playSingleAyat(ayat);
            });
        });

        content.querySelectorAll('.copy-ayat').forEach(btn => {
            btn.addEventListener('click', e => {
                const ayat = parseInt(e.currentTarget.dataset.ayat);
                copyAyat(ayat);
            });
        });

        content.querySelectorAll('.share-ayat').forEach(btn => {
            btn.addEventListener('click', e => {
                const ayat = parseInt(e.currentTarget.dataset.ayat);
                shareAyat(ayat);
            });
        });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUDIO PLAYBACK
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function playSingleAyat(ayatNum) {
        if (state.audio) {
            state.audio.pause();
            state.audio = null;
        }

        state.currentAyat = ayatNum;
        state.isPlaying = true;
        updateUI();

        state.audio = new Audio(getAudioUrl(ayatNum));
        state.audio.playbackRate = state.playbackSpeed;
        
        state.audio.play().then(() => {
            highlightAyat(ayatNum);
        }).catch(err => {
            console.error('Audio error:', err);
            showToast('âŒ Tidak dapat memainkan audio');
        });

        state.audio.onended = () => {
            if (state.repeatMode && state.currentRepeat < state.repeatCount - 1) {
                state.currentRepeat++;
                showToast(`ğŸ” Ulangan ${state.currentRepeat + 1}/${state.repeatCount}`);
                playSingleAyat(ayatNum);
            } else {
                state.currentRepeat = 0;
                state.isPlaying = false;
                updateUI();
            }
        };
    }

    function playAll() {
        state.currentAyat = 1;
        state.currentRepeat = 0;
        playSequence();
    }

    function playSequence() {
        if (state.currentAyat > CONFIG.totalAyat) {
            if (state.repeatMode && state.currentRepeat < state.repeatCount - 1) {
                state.currentRepeat++;
                state.currentAyat = 1;
                showToast(`ğŸ” Ulangan ${state.currentRepeat + 1}/${state.repeatCount}`);
                playSequence();
            } else {
                state.isPlaying = false;
                state.currentRepeat = 0;
                state.readCount++;
                saveState();
                showToast('âœ… Selesai membaca Al-Fatihah');
                updateUI();
                updateHeader();
            }
            return;
        }

        state.isPlaying = true;
        updateUI();

        if (state.audio) {
            state.audio.pause();
        }

        state.audio = new Audio(getAudioUrl(state.currentAyat));
        state.audio.playbackRate = state.playbackSpeed;

        state.audio.play().then(() => {
            highlightAyat(state.currentAyat);
        }).catch(err => {
            console.error('Audio error:', err);
            state.currentAyat++;
            playSequence();
        });

        state.audio.onended = () => {
            state.currentAyat++;
            playSequence();
        };
    }

    function stopPlayback() {
        if (state.audio) {
            state.audio.pause();
            state.audio = null;
        }
        state.isPlaying = false;
        state.currentAyat = 1;
        state.currentRepeat = 0;
        updateUI();
        renderVerses();
    }

    function highlightAyat(ayatNum) {
        document.querySelectorAll('.ilm-fh-ayat').forEach(el => el.classList.remove('playing'));
        const el = document.getElementById(`ilm-fh-ayat-${ayatNum}`);
        if (el) {
            el.classList.add('playing');
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        updateProgress();
        updatePosition();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITY ACTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function copyAyat(ayatNum) {
        const verse = FATIHAH_DATA.find(v => v.number === ayatNum);
        if (!verse) return;

        const text = `${verse.arabic}\n\n${verse.rumi}\n\n${verse.translation}\n\n- Surah Al-Fatihah, Ayat ${ayatNum}\n- IlmuAlam.com`;
        
        navigator.clipboard.writeText(text).then(() => {
            showToast('âœ… Ayat disalin ke papan klip');
        }).catch(() => {
            showToast('âŒ Tidak dapat menyalin');
        });
    }

    function shareAyat(ayatNum) {
        const verse = FATIHAH_DATA.find(v => v.number === ayatNum);
        if (!verse) return;

        const text = `Surah Al-Fatihah, Ayat ${ayatNum}:\n\n${verse.arabic}\n\n"${verse.translation}"\n\nDari: IlmuAlam.com`;

        if (navigator.share) {
            navigator.share({
                title: `Surah Al-Fatihah Ayat ${ayatNum}`,
                text: text,
                url: window.location.href
            }).catch(() => copyAyat(ayatNum));
        } else {
            copyAyat(ayatNum);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI UPDATES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateUI() {
        const playBtn = document.getElementById('ilm-fh-play');
        if (playBtn) {
            playBtn.innerHTML = state.isPlaying
                ? '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg> Jeda'
                : '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> Main Semua';
        }
    }

    function updateProgress() {
        const bar = document.getElementById('ilm-fh-progress-bar');
        if (bar) {
            bar.style.width = `${(state.currentAyat / CONFIG.totalAyat) * 100}%`;
        }
    }

    function updatePosition() {
        const pos = document.getElementById('ilm-fh-position');
        if (pos) {
            pos.textContent = `${state.currentAyat} / ${CONFIG.totalAyat}`;
        }
    }

    function updateHeader() {
        const main = document.getElementById('ilm-fh-main');
        if (main) {
            const badge = main.querySelector('.meta-badges .badge:last-child');
            if (badge) {
                badge.textContent = `ğŸ“¿ Dibaca ${state.readCount}x`;
            }
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EVENT LISTENERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function initEvents() {
        // Play/Pause
        document.getElementById('ilm-fh-play')?.addEventListener('click', () => {
            if (state.isPlaying) {
                state.audio?.pause();
                state.isPlaying = false;
                updateUI();
            } else {
                playAll();
            }
        });

        // Stop
        document.getElementById('ilm-fh-stop')?.addEventListener('click', stopPlayback);

        // Repeat
        document.getElementById('ilm-fh-repeat')?.addEventListener('click', () => {
            if (!state.repeatMode) {
                state.repeatMode = true;
                state.repeatCount = 3;
            } else if (state.repeatCount === 3) {
                state.repeatCount = 7;
            } else if (state.repeatCount === 7) {
                state.repeatCount = 11;
            } else {
                state.repeatMode = false;
                state.repeatCount = 1;
            }
            saveState();
            showToast(state.repeatMode ? `ğŸ” Ulang ${state.repeatCount}x diaktifkan` : 'ğŸ” Ulang dinyahaktifkan');
            // Refresh to update badge
            document.getElementById(CONFIG.containerId).innerHTML = generateHTML();
            renderVerses();
            initEvents();
        });

        // Qari selection
        document.getElementById('ilm-fh-qari')?.addEventListener('change', e => {
            state.currentQari = e.target.value;
            saveState();
            showToast('ğŸ™ï¸ Qari ditukar');
        });

        // Dark mode
        document.getElementById('ilm-fh-dark')?.addEventListener('click', () => {
            state.darkMode = !state.darkMode;
            document.getElementById('ilm-fh-main')?.classList.toggle('dark');
            document.getElementById('ilm-fh-dark').textContent = state.darkMode ? 'â˜€ï¸ Cerah' : 'ğŸŒ™ Gelap';
            saveState();
        });

        // Toggles
        const toggles = [
            { id: 'ilm-fh-rumi-toggle', key: 'showRumi' },
            { id: 'ilm-fh-trans-toggle', key: 'showTranslation' },
            { id: 'ilm-fh-wbw-toggle', key: 'showWordByWord' },
            { id: 'ilm-fh-tajwid-toggle', key: 'showTajwid' },
            { id: 'ilm-fh-tafsir-toggle', key: 'showTafsir' }
        ];

        toggles.forEach(t => {
            document.getElementById(t.id)?.addEventListener('click', e => {
                state[t.key] = !state[t.key];
                e.target.classList.toggle('active');
                saveState();
                renderVerses();
            });
        });

        // Speed slider
        document.getElementById('ilm-fh-speed-slider')?.addEventListener('input', e => {
            state.playbackSpeed = parseFloat(e.target.value);
            document.getElementById('ilm-fh-speed-label').textContent = `${state.playbackSpeed}x`;
            if (state.audio) {
                state.audio.playbackRate = state.playbackSpeed;
            }
            saveState();
        });

        // Navigation
        document.getElementById('ilm-fh-prev')?.addEventListener('click', () => {
            if (state.currentAyat > 1) {
                state.currentAyat--;
                highlightAyat(state.currentAyat);
            }
        });

        document.getElementById('ilm-fh-next')?.addEventListener('click', () => {
            if (state.currentAyat < CONFIG.totalAyat) {
                state.currentAyat++;
                highlightAyat(state.currentAyat);
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    document.getElementById('ilm-fh-play')?.click();
                    break;
                case 'ArrowLeft':
                    document.getElementById('ilm-fh-prev')?.click();
                    break;
                case 'ArrowRight':
                    document.getElementById('ilm-fh-next')?.click();
                    break;
                case 'r':
                case 'R':
                    document.getElementById('ilm-fh-repeat')?.click();
                    break;
            }
        });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function init() {
        const container = document.getElementById(CONFIG.containerId);
        if (!container) {
            console.error('ILM Al-Fatihah: Container not found');
            return;
        }

        loadState();
        container.innerHTML = generateHTML();
        renderVerses();
        initEvents();

        // Prefetch audio
        CONFIG.qariList.slice(0, 2).forEach(q => {
            for (let i = 1; i <= 7; i++) {
                const link = document.createElement('link');
                link.rel = 'prefetch';
                link.href = `https://cdn.islamic.network/quran/audio/128/${q.id}/${i}.mp3`;
                document.head.appendChild(link);
            }
        });

        console.log('%cğŸ•Œ IlmuAlam Al-Fatihah Reader v3.0 Ready', 'color:#249749;font-weight:bold;font-size:14px');
    }

    // Auto-init
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // Expose globally
    window.IlmAlFatihahReader = { state, CONFIG, FATIHAH_DATA };

})();
