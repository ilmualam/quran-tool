/*!
 * IlmuAlam Quran Tool â€“ Surah Al-Waqiah
 * (c) 2025 IlmuAlam.com. All rights reserved.
 */
document.addEventListener("DOMContentLoaded",function(){(function(){const e=[],t=56,n="bookmarked_"+t,o=document.getElementById("ilmu-saw-ayah-list"),a=document.getElementById("ilmu-saw-audio-player"),l=document.getElementById("ilmu-saw-play-pause-all"),s=document.getElementById("ilmu-saw-autoplay-toggle-btn"),d=document.getElementById("ilmu-saw-loading"),i=document.querySelector(".ilmu-saw-controls"),c=document.getElementById("ilmu-saw-copy-notification");let r=-1,u=!1,y=!0,m=new Set(f());async function p(){try{const t=await fetch("https://api.alquran.cloud/v1/surah/"+n.split("_")[1]+"/editions/ar.alafasy,ms.basmeih,en.transliteration");if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();d&&(d.style.display="none"),i&&(i.style.display="flex");const a=o.data[0].ayahs,l=o.data[1].ayahs,s=o.data[2].ayahs;for(let t=0;t<a.length;t++)e.push({number:a[t].numberInSurah,arabic:a[t].text,translation:l[t].text,transliteration:s[t]?s[t].text:"",audio:a[t].audio});h()}catch(e){d&&(d.innerHTML='<p style="color:red;">Maaf, gagal memuatkan data Surah Al-Waqiah. Sila cuba lagi nanti.</p>'),console.error("Error fetching Surah Al-Waqiah data:",e)}}function h(){if(!o)return;o.innerHTML="",e.forEach((t,n)=>{const a=document.createElement("div");a.className="ilmu-saw-ayah",a.id="ilmu-saw-ayah-"+n,m.has(n)&&a.classList.add("ilmu-saw-bookmarked");const l=m.has(n)?'<svg fill="#ffc107" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"></path></svg>':'<svg fill="currentColor" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"></path></svg>';a.innerHTML=`<div class="ilmu-saw-ayah-header">
<span class="ilmu-saw-ayah-number">Al-Waqiah : Ayat ${t.number}</span>
<button class="ilmu-saw-action-button" data-action="play" data-index="${n}" aria-label="Mainkan Ayat ${t.number}">
<svg fill="#249749" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
</button>
</div>
<p class="ilmu-saw-arabic">${t.arabic}</p>
<p class="ilmu-saw-transliteration">${t.transliteration||""}</p>
<p class="ilmu-saw-translation">${t.translation}</p>
<div class="ilmu-saw-ayah-actions">
<button class="ilmu-saw-action-button" data-action="copy" data-index="${n}">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg>
Copy
</button>
<button class="ilmu-saw-action-button" data-action="share" data-index="${n}">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 8.11C7.5 7.61 6.79 7.3 6 7.3c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"></path></svg>
Share
</button>
<button class="ilmu-saw-action-button" data-action="bookmark" data-index="${n}">
${l}
${m.has(n)?"Bookmarked":"Bookmark"}
</button>
</div>`,o.appendChild(a)}),o.addEventListener("click",g),l&&l.addEventListener("click",function(){u?b():v(0)}),a&&a.addEventListener("ended",function(){y&&r<e.length-1?v(r+1):b()}),s&&(s.addEventListener("click",function(){y=!y,k()}),k())}function g(t){const n=t.target.closest(".ilmu-saw-action-button");if(!n)return;const o=n.dataset.action,a=parseInt(n.dataset.index,10),l=e[a];if(!l)return;const s=window.location.href.split("#")[0],d=s+"#ilmu-saw-ayah-"+a,i=["Surah Al-Waqiah, Ayat "+l.number,"",l.arabic,l.transliteration||"","",'Terjemahan: "'+l.translation+'"',"","Sumber: ilmualam.com",d].join("\n");"play"===o&&v(a),"copy"===o&&w(i),"share"===o&&L(i,d),"bookmark"===o&&E(a,n)}function v(t){t>=e.length||t<0?b():(r=t,a.src=e[t].audio,a.play().catch(e=>console.error("Audio error:",e)),u=!0,S())}function b(){try{a.pause(),a.currentTime=0}catch(e){}u=!1,r=-1,S()}function S(){l&&(l.textContent=u?"Hentikan Bacaan":"Mula Bacaan"),document.querySelectorAll(".ilmu-saw-ayah").forEach((t,n)=>{const o=t.querySelector('[data-action="play"] svg path');n===r&&u?(t.classList.add("ilmu-saw-playing"),o&&o.setAttribute("d","M6 19h4V5H6v14zm8-14v14h4V5h-4z"),t.scrollIntoView({behavior:"smooth",block:"center"})):(t.classList.remove("ilmu-saw-playing"),o&&o.setAttribute("d","M8 5v14l11-7z"))})}function k(){s&&(s.textContent=y?"AutoPlay: ON":"AutoPlay: OFF",s.classList.toggle("ilmu-saw-autoplay-off",!y),s.setAttribute("aria-pressed",y?"true":"false"))}function w(e){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>x()).catch(t=>{console.error("Clipboard error:",t),A(e)}):A(e)}function A(e){try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),x()}catch(e){console.error("Fallback copy failed:",e)}}async function L(e,t){navigator.share?await navigator.share({title:"Ayat dari Surah Al-Waqiah",text:e,url:t}).catch(e=>{console.error("Share failed:",e)}):w(t)}function E(t,o){const a=document.getElementById("ilmu-saw-ayah-"+t);m.has(t)?(m.delete(t),a&&a.classList.remove("ilmu-saw-bookmarked"),o.innerHTML='<svg fill="currentColor" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"></path></svg> Bookmark'):(m.add(t),a&&a.classList.add("ilmu-saw-bookmarked"),o.innerHTML='<svg fill="#ffc107" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"></path></svg> Bookmarked'),C(Array.from(m))}function x(){c&&(c.style.opacity=1,setTimeout(()=>{c.style.opacity=0},2e3))}function f(){try{const e=localStorage.getItem(n);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.error("Error reading bookmarks:",e),[]}}function C(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(e){console.error("Error saving bookmarks:",e)}}p()})()});
